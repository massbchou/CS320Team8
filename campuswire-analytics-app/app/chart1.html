import React, { useEffect, useRef } from "react";
import Chart from "chart.js/auto";
import PodiumStep from "./PodiumStep";

export default function Podium({ namesArr, winnerContributionArr }) {
  // Combine the names and post counts into an array of objects
  const winners = namesArr.map((name, index) => ({
    name,
    postCount: winnerContributionArr[index],
    position: index,
  }));

  // Extract podium winners based on positions
  const podium = [8, 6, 4, 2, 0, 1, 3, 5, 7, 9]
    .reduce((podiumOrder, position) => [...podiumOrder, winners[position]], [])
    .filter(Boolean);

  // Ref for the chart canvas element
  const chartRef = useRef();

  useEffect(() => {
    // Extract data for the chart
    const names = podium.map((winner) => winner.name);
    const postCount = podium.map((winner) => winner.postCount);

    // Chart data
    const data = {
      labels: names,
      datasets: [
        {
          label: "Post Count",
          data: postCount,
          backgroundColor: "rgba(75, 192, 192, 0.2)",
          borderColor: "rgba(75, 192, 192, 1)",
          borderWidth: 1,
        },
      ],
    };

    // Chart configuration
    const config = {
      type: "bar",
      data: data,
    };

    // Get the chart canvas element
    const ctx = chartRef.current.getContext("2d");

    // Create the bar chart
    new Chart(ctx, config);
  }, [podium]);

  return (
    <div>
      <div
        style={{
          display: "grid",
          gridAutoFlow: "column dense",
          gap: ".5rem",
          marginTop: "2rem",
          justifyContent: "center",
          justifyItems: "center",
          alignContent: "flex-end",
          alignItems: "flex-end",
          borderBottom: "1px solid #e5e7eb",
          height: 250,
        }}
      >
        {podium.map((winner) => (
          <PodiumStep key={winner.position} podium={podium} winner={winner} />
        ))}
      </div>

      {/* Chart canvas */}
      <canvas ref={chartRef} width="400" height="200"></canvas>
    </div>
  );
}
